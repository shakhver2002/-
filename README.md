Немного от себя и описания понимания результата или "Как писался код и статья"

Среди долгого поиска в интеренете нормальных библиотек, поняла что большинство из них написано очень давно (Пример: библиотека validate_email написана аж в 2015 году (https://pypi.org/search/?q=validate+email)) и при использовании всплывали ошибки и лень было с ними разбираться. Чат GPT выдавал какую-то, на мой взгляд, не совсем правильные варианты, что будет потрачено куча сил на получение от него нужного результата и информации. И вот спустя определенное время поиска наткнулся на статью на основе которой и сделал все: https://mailfloss.com/python-email-validation-techniques-developers-guide/ Дальше дело техники: почитать что это вообще такое и грамотно, выстроив скелет кода, скормить все GPT. Результат получился неплохой, но пришлось самому немного подебажить и поправить код и статью в некоторых местах.

По подову цвета, здесь я выбрала 3 варианта:

Зеленый: В случае гарантированного успеха проверки email
Желтый: Бывает так, что ответ от сервера очень долгий и непонятно рабочий email или нет, поэтому решил пометить желтым цветом
Красный: Если ошибка и email не рабочий
Скажу напоследок, при тестовых прогонах на малых количествах (до 100 штук), "желтые" email становились зелеными, но конечный вариант будет только один (в силу того, что 10К записей прогнать это очень долгий процесс (около ~7-8 часов (приблизительно на 4000-ом email'е скорость 2 шт. за 6 сек.)!), и физически лень это делать без острой необходимости:D ). Поэтому рекомендую пользоваться только "зелеными" и если совсем не хватает количества, то только в этом случае переходить к "желтым". Далее вся информация по объяснению принципа проверки находится ниже. Но настоятельно рекоммендую поискать все в интернете и самому почитать, тк не могу с уверенностью ответить за 100% корректность информации.

P.S. Описание создания нового excel файла и считывания с существующего не включил, там вроде и так все понятно.

Полная проверка email: что мы проверяем, почему и как это работает

Проверка email — это процесс, который помогает убедиться, что указанный адрес электронной почты существует, доступен для доставки сообщений и правильно настроен. Давайте разберемся, что именно мы проверяем, почему это важно и как работает каждая технология в этом процессе.

Почему использованы именно эти библиотеки?

re (Regular Expressions):

Используется для проверки формата email. Это удобно, так как регулярные выражения позволяют быстро и точно определить, соответствует ли строка определенному шаблону (например, наличие @ и домена).
Библиотека встроена в Python и не требует дополнительной установки, что делает ее легкой и быстрой в использовании.
dns.resolver:

Применяется для проверки существования MX-записей у домена. Это важно, так как MX-записи указывают, какие почтовые сервера обрабатывают письма для указанного домена.
Библиотека dnspython обеспечивает мощные функции работы с DNS-запросами, такие как проверка MX, A или TXT-записей, что делает ее стандартом для работы с DNS в Python.
smtplib:

Используется для проверки адреса email через SMTP. Эта библиотека позволяет отправлять команды протокола SMTP, такие как HELO, MAIL FROM, RCPT TO, и анализировать ответы сервера.
Она также встроена в Python, что упрощает настройку и интеграцию без необходимости устанавливать сторонние зависимости.
Эти библиотеки выбраны, потому что они хорошо документированы, просты в использовании и обеспечивают все необходимые инструменты для работы с форматами email, DNS-записями и протоколом SMTP. Это позволяет разработать надежный и эффективный процесс проверки email без использования дополнительных платных сервисов.

Что мы проверяем при проверке email?

Формат email:

Проверяем, что email имеет правильную структуру (например, name@domain.com).
Если формат неверный, это очевидная ошибка, и письмо просто не сможет быть отправлено.
Существование домена:

Проверяем, существует ли домен (часть после символа @) и настроены ли у него MX-записи.
Это позволяет узнать, может ли домен вообще принимать почту.
Существование email через SMTP:

Проверяем, принимает ли указанный сервер конкретный email-адрес.
Это более глубокий уровень проверки, который помогает узнать, доступен ли email получателя для отправки.
Почему важны эти проверки?

Экономия ресурсов:

Отправка писем на несуществующие адреса приводит к возвратам (bounces), что увеличивает нагрузку на ваши серверы.
Репутация отправителя:

Частые отправки на несуществующие адреса могут снизить репутацию вашего домена и IP-адреса. Это может привести к тому, что ваши письма будут отправляться в спам.
Защита данных:

Проверка помогает избежать ошибок и отправки конфиденциальной информации на неверные адреса.
Улучшение качества рассылки:

Проверяя адреса заранее, вы поддерживаете актуальность базы данных и увеличиваете шансы на успешную доставку.
Как работает каждая проверка?

1. Проверка формата email

Email состоит из двух частей:

Имя пользователя (local part): то, что стоит до @.
Домен (domain): то, что идет после @.
Пример правильного email: user@example.com

user — имя пользователя.
example.com — домен.
Регулярное выражение, которое часто используют для проверки формата:

r"[^@]+@[^@]+\.[^@]+"
Оно проверяет, что email содержит:

Имя пользователя.
Символ @.
Доменное имя, которое включает точку (например, .com, .org).
Если формат неправильный, дальнейшие проверки не имеют смысла.

2. Проверка существования домена и MX-записей

Что такое домен?

Домен — это часть email после символа @. Например, в адресе user@gmail.com домен — это gmail.com. Чтобы email работал, домен должен существовать в системе DNS (Domain Name System).

Что такое MX-записи?

MX-записи (Mail Exchange) — это специальные записи DNS, которые указывают на почтовые серверы, принимающие письма для домена. Они сообщают, куда должно быть направлено письмо.

Пример: для домена gmail.com MX-записи могут выглядеть так:

Priority   Mail Server
10         alt1.gmail-smtp-in.l.google.com
20         alt2.gmail-smtp-in.l.google.com
Priority — указывает приоритет почтового сервера. Сервер с меньшим числом (например, 10) будет использоваться в первую очередь.
Mail Server — адрес почтового сервера, который принимает сообщения.
Как происходит проверка?

Для проверки MX-записей используется библиотека dns.resolver из пакета dnspython. Она предоставляет мощный и гибкий инструмент для выполнения DNS-запросов любого типа, включая MX-записи.

Почему именно dns.resolver?

Гибкость и универсальность: Библиотека поддерживает множество типов DNS-запросов (A, AAAA, TXT, MX, и т. д.), что делает её подходящей для различных задач.
Лёгкость интеграции: Библиотека легко настраивается и используется, что позволяет без труда интегрировать её в проекты на Python.
Обширная документация: Хорошо документирована, что облегчает её использование даже новичкам.
Кроссплатформенность: Работает на всех популярных операционных системах, что делает её универсальным выбором для Python-разработчиков.
Преимущества перед альтернативами:

В отличие от более сложных DNS-решателей, таких как системы на основе C-библиотек, dns.resolver работает на чистом Python, что облегчает её установку и поддержку.
Многие другие библиотеки или подходы для работы с DNS-запросами могут быть узкоспециализированными, в то время как dns.resolver предоставляет широкий спектр возможностей.
Использование стандартных инструментов операционных систем, таких как nslookup, не всегда удобно или эффективно для программных решений, а dns.resolver предоставляет всё необходимое в рамках Python-кода.
Программа отправляет запрос в DNS-сервер, чтобы узнать, есть ли MX-записи у домена. Если MX-записи отсутствуют, домен не может принимать почту.

3. Проверка email через SMTP

Что такое SMTP?

SMTP (Simple Mail Transfer Protocol) — это протокол, используемый для отправки писем. В процессе проверки мы подключаемся к почтовому серверу домена через SMTP и отправляем несколько команд, чтобы узнать, существует ли email.

Команды SMTP, используемые для проверки

MAIL FROM:

Указывает адрес отправителя. Например, MAIL FROM:<test@example.com>.
Этот адрес может быть любым, так как используется только для тестирования.
Мы указываем случайный адрес (например, test@example.com), чтобы не раскрывать реальный email отправителя и избежать возможных блокировок.
Использование случайного адреса минимизирует вероятность того, что сервер откажет в соединении из-за подозрений в спаме.
RCPT TO:

Указывает адрес получателя. Например, RCPT TO:<user@example.com>.
Эта команда проверяет, готов ли сервер принять письмо для указанного email.
Сервер отвечает кодом состояния (например, 250 — успешно, 550 — адрес не существует).
Почему случайный адрес предпочтителен?

Использование случайного адреса отправителя (MAIL FROM) минимизирует вероятность блокировки или подозрений в спаме. Это важно, так как тестирование с реальным адресом может:

Привести к занесению вашего домена в чёрный список.
Создать дополнительные риски для утечки данных отправителя.
Случайный адрес используется только для установления соединения и тестирования. Он никак не влияет на реальные отправки.

Заключение

Процесс проверки email — это последовательная проверка формата, домена и существования адреса. Использование библиотек re, dns.resolver и smtplib обеспечивает точность, надёжность и эффективность. Это позволяет минимизировать ошибки, повысить качество рассылок и избежать потерь репутации почтового сервера.# -
